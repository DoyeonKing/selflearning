# 校医院实时导航部署指南

## 📋 前期准备

### 1. 获取校医院GPS坐标

**方法一：使用高德地图**
1. 打开高德地图网页版：https://lbs.amap.com/tools/picker
2. 搜索您的校医院位置
3. 点击地图，获取坐标（格式：经度,纬度）
4. 记录医院四个角的坐标

**方法二：使用百度地图**
1. 打开百度地图拾取坐标系统：https://api.map.baidu.com/lbsapi/getpoint/index.html
2. 搜索校医院
3. 点击获取坐标

**示例：**
```
假设校医院中心坐标：
纬度：39.9486°N（北纬）
经度：116.3361°E（东经）

医院范围：约100米 × 100米

计算坐标范围：
- 纬度每0.001度 ≈ 111米
- 经度每0.001度 ≈ 111米（在北京附近）

配置：
minLat: 39.9476 (中心 - 0.001)
maxLat: 39.9496 (中心 + 0.001)
minLng: 116.3351 (中心 - 0.001)
maxLng: 116.3371 (中心 + 0.001)
```

### 2. 绘制医院平面图

1. **获取医院楼层平面图**
   - 联系校医院管理部门获取CAD图纸或平面图
   - 或者自己实地测量绘制简图

2. **标注关键位置**
   - 大门入口
   - 分诊台/挂号处
   - 各个诊室（内科、外科、儿科等）
   - 电梯/楼梯
   - 药房
   - 收费处
   - 洗手间

3. **转换为网格坐标**
   - 当前地图网格：40×30
   - 根据实际比例将实际位置转换为网格坐标
   - 示例：如果医院是80米×60米，则每个网格约2米×2米

### 3. 配置诊室数据

在数据库 `locations` 表中添加真实的诊室信息：

```sql
-- 示例数据
INSERT INTO locations (location_name, department_id, floor_level, building, room_number, capacity, map_node_id) VALUES
('内科诊室', 1, 1, '门诊楼', '101', 3, 4),
('外科诊室', 2, 1, '门诊楼', '102', 3, 5),
('儿科诊室', 3, 2, '门诊楼', '201', 2, 6),
('妇科诊室', 4, 2, '门诊楼', '202', 2, 7);
```

## 📱 真机调试步骤

### 方案一：HBuilderX真机运行（推荐）

1. **准备工作**
   ```bash
   # 确保已安装HBuilderX
   # 打开项目：uni_app 文件夹
   ```

2. **Android真机调试**
   - 手机开启开发者模式和USB调试
   - 用USB连接手机到电脑
   - HBuilderX菜单：运行 → 运行到手机或模拟器 → 选择你的设备
   - 首次运行会自动安装基座到手机

3. **iOS真机调试**
   - 需要Mac电脑
   - 需要Apple开发者账号
   - 配置证书和描述文件
   - HBuilderX菜单：运行 → 运行到手机或模拟器 → iOS设备

### 方案二：打包自定义基座

1. **Android打包**
   ```
   HBuilderX → 发行 → 原生App-云打包
   - 选择Android
   - 配置包名、应用名称
   - 配置图标
   - 选择"打自定义调试基座"
   - 提交打包
   ```

2. **下载安装**
   - 打包完成后下载APK
   - 安装到手机
   - 使用自定义基座运行调试

### 方案三：打包正式版

```
HBuilderX → 发行 → 原生App-云打包
- 选择平台（Android/iOS）
- 配置应用信息
- 配置签名证书
- 选择"打正式包"
- 提交打包
```

## 🔧 现场实施步骤

### 第一阶段：基础定位测试（1-2天）

1. **配置GPS坐标范围**
   - 修改 `uni_app/pages/navigation/index.vue` 中的 `mapBounds`
   - 填入实际的校医院GPS坐标范围

2. **真机测试GPS定位**
   - 在校医院门口打开APP
   - 点击"📍 定位当前位置"
   - 验证是否能成功定位
   - 检查定位精度（一般5-20米）

3. **调整坐标映射**
   - 如果定位偏差大，调整 `gpsToGrid` 方法的映射算法
   - 可能需要实地测试多个点进行校准

### 第二阶段：手动定位部署（1天）

1. **配置所有节点**
   - 在数据库中添加所有诊室的location记录
   - 后端MapService会自动加载这些数据

2. **测试手动选择**
   - 打开导航页面
   - 点击"📌 手动选择位置"
   - 验证所有节点是否正确显示
   - 测试从各个位置到各个诊室的导航路径

### 第三阶段：二维码定位部署（2-3天）

1. **生成定位二维码**
   ```javascript
   // 使用在线二维码生成器，生成以下内容的二维码：
   HOSPITAL_NODE_1  // 医院大门
   HOSPITAL_NODE_2  // 分诊台
   HOSPITAL_NODE_3  // 电梯口
   HOSPITAL_NODE_4  // 内科诊室
   HOSPITAL_NODE_5  // 外科诊室
   // ... 根据实际节点数量生成
   ```

2. **打印并张贴二维码**
   - 打印尺寸：建议A5或A4大小，方便扫描
   - 张贴位置：每个关键位置的墙上或指示牌上
   - 高度：建议1.2-1.5米，方便手机扫描
   - 保护措施：覆膜或透明保护套，防水防污

3. **制作说明标识**
   ```
   ╔════════════════════════════╗
   ║    智能导航定位点          ║
   ║                            ║
   ║    [二维码]                ║
   ║                            ║
   ║  扫描二维码获取当前位置    ║
   ║  前往预约诊室              ║
   ╚════════════════════════════╝
   ```

4. **测试扫码定位**
   - 在每个位置扫码
   - 验证是否正确识别位置
   - 测试导航路径是否正确

## 🎯 推荐的实施方案

### 方案选择建议

**情况一：GPS信号好（医院建筑较矮、室外活动多）**
- 主要使用：GPS定位
- 辅助使用：手动选择（室内或GPS不准时）
- 优点：自动化程度高，用户体验好
- 缺点：室内精度较低

**情况二：多层建筑、室内活动为主（推荐）**
- 主要使用：二维码扫码定位
- 辅助使用：手动选择位置
- 备用：GPS定位（室外）
- 优点：精度最高（0误差），成本低
- 缺点：需要在现场张贴二维码

**情况三：预算充足，追求最佳体验**
- 部署蓝牙iBeacon硬件
- 实现精准室内定位（精度1-3米）
- 需要额外采购硬件设备
- 需要专业技术人员配置

### 最简单的实施方案（推荐用于初期测试）

**只需要1天完成：**

1. **配置坐标（30分钟）**
   - 在地图上查找校医院GPS坐标
   - 修改配置文件

2. **打包安装（1小时）**
   - 打包Android APK
   - 安装到测试手机

3. **现场测试（2-3小时）**
   - 使用"手动选择位置"功能
   - 从大门导航到各个诊室
   - 验证路径是否合理

4. **调整优化（2-3小时）**
   - 根据测试结果调整节点坐标
   - 优化路径算法
   - 完善UI提示

## 📝 配置检查清单

### 前端配置
- [ ] 修改 `mapBounds` GPS坐标范围
- [ ] 确认所有节点名称与实际一致
- [ ] 测试所有导航路径
- [ ] 检查UI显示是否正常

### 后端配置  
- [ ] 数据库 `locations` 表数据完整
- [ ] MapService 节点坐标配置正确
- [ ] 网格地图障碍物设置合理
- [ ] 接口测试通过

### 权限配置
- [ ] Android定位权限配置
- [ ] iOS定位权限配置
- [ ] 相机权限（扫码功能）
- [ ] 网络权限

### 现场部署
- [ ] 二维码打印并张贴（如果使用）
- [ ] 指示标识清晰
- [ ] 测试所有定位点
- [ ] 用户培训（可选）

## 🚀 快速开始（最小化实施）

如果您想快速验证功能，可以这样做：

```bash
# 1. 修改GPS坐标配置
# 编辑 uni_app/pages/navigation/index.vue
# 填入您校医院的GPS坐标范围

# 2. 打包运行
# 使用HBuilderX打开项目
# 连接手机
# 点击"运行" → "运行到手机"

# 3. 现场测试
# 在校医院使用"手动选择位置"功能
# 测试导航功能
```

**第一次测试建议：**
- 不需要配置真实GPS（使用默认的即可）
- 使用"手动选择位置"功能进行测试
- 重点验证导航逻辑和路径规划
- 确认UI和交互流程

**后续优化：**
- 配置真实GPS坐标
- 部署二维码定位
- 优化路径算法
- 美化UI界面

## 💡 常见问题

### Q1: 真机调试必须吗？
**A:** 是的！因为：
- GPS定位需要真实的手机硬件
- 模拟器无法准确模拟GPS
- 扫码功能需要真实的摄像头
- 需要测试实际的定位精度

### Q2: 没有Android手机怎么办？
**A:** 
- 可以借用同学/同事的Android手机
- 或者使用iOS设备（需要Mac电脑）
- 或者先使用"手动选择位置"功能进行基础测试

### Q3: GPS定位不准怎么办？
**A:**
- 优先使用"手动选择位置"（最实用）
- 或部署二维码定位（最精确）
- GPS主要用于室外或粗略定位

### Q4: 需要购买硬件吗？
**A:**
- 不需要！三种定位方式都不需要额外硬件
- 只有想要更高精度室内定位才需要蓝牙iBeacon
- 建议先用二维码方案，成本几乎为零

## 📞 技术支持

如果遇到问题，可以检查：
1. 控制台日志输出
2. 定位权限是否授予
3. GPS坐标配置是否正确
4. 数据库数据是否完整

---

**祝您部署顺利！** 🎉











